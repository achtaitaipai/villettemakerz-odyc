
<html lang="fr">
<head>
<meta charset="utf-8" />

</head>
<body>
  <div id="app"></div>
  
  <script>
var odyc = (function (exports) {
	'use strict';

	var A=class{rect;width;height;position=[0,0];screenWidth;screenHeight;constructor(x){this.screenWidth=x.screenWidth,this.screenHeight=x.screenHeight,x.cameraWidth&&x.cameraHeight&&(this.width=x.cameraWidth,this.height=x.cameraHeight,this.rect={left:(x.screenWidth-this.width)*.5,right:(x.screenWidth+this.width)*.5-1,top:(x.screenHeight-this.height)*.5,bottom:(x.screenHeight+this.height)*.5-1});}update(x,r){let[t,n]=x;if(!this.rect||!this.screenWidth||!this.screenHeight){this.position[0]=Math.floor(t/this.screenWidth)*this.screenWidth,this.position[1]=Math.floor(n/this.screenHeight)*this.screenHeight,this.clamp(r);return}let[i,s]=this.position,o=t-i,a=n-s;o<this.rect.left&&(this.position[0]-=this.rect.left-o),o>this.rect.right&&(this.position[0]+=o-this.rect.right),a<this.rect.top&&(this.position[1]-=this.rect.top-a),a>this.rect.bottom&&(this.position[1]+=a-this.rect.bottom),this.clamp(r);}reset(){this.position=[0,0];}clamp(x){let[r,t]=x;this.position[0]=Math.max(0,Math.min(this.position[0],r-this.screenWidth)),this.position[1]=Math.max(0,Math.min(this.position[1],t-this.screenHeight));}},O=e=>new A(e);var V={messageBackground:"#212529",messageColor:"#f8f9fa",dialogBackground:"#212529",dialogColor:"#f8f9fa",colors:["#212529","#f8f9fa","#ced4da","#228be6","#fa5252","#fcc419","#ff922b","#40c057","#f06595","#a52f01"],screenWidth:8,screenHeight:8,cellWidth:8,cellHeight:8,background:1,volume:.5,controls:{LEFT:"ArrowLeft",RIGHT:"ArrowRight",UP:"ArrowUp",DOWN:"ArrowDown",ACTION:["Enter","Space"]},player:{sprite:0},templates:{},map:`
		........
		........
		........
		........
		........
		........
		........
		........
	`};var F=[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[24,60,60,24,24,0,24,0],[54,54,0,0,0,0,0,0],[54,54,127,54,127,54,54,0],[12,62,3,30,48,31,12,0],[0,99,51,24,12,102,99,0],[28,54,28,110,59,51,110,0],[6,6,3,0,0,0,0,0],[24,12,6,6,6,12,24,0],[6,12,24,24,24,12,6,0],[0,102,60,255,60,102,0,0],[0,12,12,63,12,12,0,0],[0,0,0,0,0,12,12,6],[0,0,0,63,0,0,0,0],[0,0,0,0,0,12,12,0],[96,48,24,12,6,3,1,0],[62,99,115,123,111,103,62,0],[12,14,12,12,12,12,63,0],[30,51,48,28,6,51,63,0],[30,51,48,28,48,51,30,0],[56,60,54,51,127,48,120,0],[63,3,31,48,48,51,30,0],[28,6,3,31,51,51,30,0],[63,51,48,24,12,12,12,0],[30,51,51,30,51,51,30,0],[30,51,51,62,48,24,14,0],[0,12,12,0,0,12,12,0],[0,12,12,0,0,12,12,6],[24,12,6,3,6,12,24,0],[0,0,63,0,0,63,0,0],[6,12,24,48,24,12,6,0],[30,51,48,24,12,0,12,0],[62,99,123,123,123,3,30,0],[12,30,51,51,63,51,51,0],[63,102,102,62,102,102,63,0],[60,102,3,3,3,102,60,0],[31,54,102,102,102,54,31,0],[127,70,22,30,22,70,127,0],[127,70,22,30,22,6,15,0],[60,102,3,3,115,102,124,0],[51,51,51,63,51,51,51,0],[30,12,12,12,12,12,30,0],[120,48,48,48,51,51,30,0],[103,102,54,30,54,102,103,0],[15,6,6,6,70,102,127,0],[99,119,127,127,107,99,99,0],[99,103,111,123,115,99,99,0],[28,54,99,99,99,54,28,0],[63,102,102,62,6,6,15,0],[30,51,51,51,59,30,56,0],[63,102,102,62,54,102,103,0],[30,51,7,14,56,51,30,0],[63,45,12,12,12,12,30,0],[51,51,51,51,51,51,63,0],[51,51,51,51,51,30,12,0],[99,99,99,107,127,119,99,0],[99,99,54,28,28,54,99,0],[51,51,51,30,12,12,30,0],[127,99,49,24,76,102,127,0],[30,6,6,6,6,6,30,0],[3,6,12,24,48,96,64,0],[30,24,24,24,24,24,30,0],[8,28,54,99,0,0,0,0],[0,0,0,0,0,0,0,255],[12,12,24,0,0,0,0,0],[0,0,30,48,62,51,110,0],[7,6,6,62,102,102,59,0],[0,0,30,51,3,51,30,0],[56,48,48,62,51,51,110,0],[0,0,30,51,63,3,30,0],[28,54,6,15,6,6,15,0],[0,0,110,51,51,62,48,31],[7,6,54,110,102,102,103,0],[12,0,14,12,12,12,30,0],[48,0,48,48,48,51,51,30],[7,6,102,54,30,54,103,0],[14,12,12,12,12,12,30,0],[0,0,51,127,127,107,99,0],[0,0,31,51,51,51,51,0],[0,0,30,51,51,51,30,0],[0,0,59,102,102,62,6,15],[0,0,110,51,51,62,48,120],[0,0,59,110,102,6,15,0],[0,0,62,3,30,48,31,0],[8,12,62,12,12,44,24,0],[0,0,51,51,51,51,110,0],[0,0,51,51,51,30,12,0],[0,0,99,107,127,127,54,0],[0,0,99,54,28,54,99,0],[0,0,51,51,51,62,48,31],[0,0,63,25,12,38,63,0],[56,12,12,7,12,12,56,0],[24,24,24,0,24,24,24,0],[7,12,12,56,12,12,7,0],[110,59,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[24,24,0,24,24,24,24,0],[24,24,126,3,3,126,24,24],[28,54,38,15,6,103,63,0],[0,0,99,62,54,62,99,0],[51,51,30,63,12,63,12,12],[24,24,24,0,24,24,24,0],[124,198,28,54,54,28,51,30],[51,0,0,0,0,0,0,0],[60,66,153,133,133,153,66,60],[60,54,54,124,0,0,0,0],[0,204,102,51,102,204,0,0],[0,0,0,63,48,48,0,0],[0,0,0,0,0,0,0,0],[60,66,157,165,157,165,66,60],[126,0,0,0,0,0,0,0],[28,54,54,28,0,0,0,0],[24,24,126,24,24,0,126,0],[28,48,24,12,60,0,0,0],[28,48,24,48,28,0,0,0],[24,12,0,0,0,0,0,0],[0,0,102,102,102,62,6,3],[254,219,219,222,216,216,216,0],[0,0,0,24,24,0,0,0],[0,0,0,0,0,24,48,30],[8,12,8,28,0,0,0,0],[28,54,54,28,0,0,0,0],[0,51,102,204,102,51,0,0],[195,99,51,189,236,246,243,3],[195,99,51,123,204,102,51,240],[3,196,99,180,219,172,230,128],[12,0,12,6,3,51,30,0],[7,0,28,54,99,127,99,0],[112,0,28,54,99,127,99,0],[28,54,0,62,99,127,99,0],[110,59,0,62,99,127,99,0],[99,28,54,99,127,99,99,0],[12,12,0,30,51,63,51,0],[124,54,51,127,51,51,115,0],[30,51,3,51,30,24,48,30],[7,0,63,6,30,6,63,0],[56,0,63,6,30,6,63,0],[12,18,63,6,30,6,63,0],[54,0,63,6,30,6,63,0],[7,0,30,12,12,12,30,0],[56,0,30,12,12,12,30,0],[12,18,0,30,12,12,30,0],[51,0,30,12,12,12,30,0],[63,102,111,111,102,102,63,0],[63,0,51,55,63,59,51,0],[14,0,24,60,102,60,24,0],[112,0,24,60,102,60,24,0],[60,102,24,60,102,60,24,0],[110,59,0,62,99,99,62,0],[195,24,60,102,102,60,24,0],[0,54,28,8,28,54,0,0],[92,54,115,123,111,54,29,0],[14,0,102,102,102,102,60,0],[112,0,102,102,102,102,60,0],[60,102,0,102,102,102,60,0],[51,0,51,51,51,51,30,0],[112,0,102,102,60,24,24,0],[15,6,62,102,102,62,6,15],[0,30,51,31,51,31,3,3],[7,0,30,48,62,51,126,0],[56,0,30,48,62,51,126,0],[126,195,60,96,124,102,252,0],[110,59,30,48,62,51,126,0],[51,0,30,48,62,51,126,0],[12,12,30,48,62,51,126,0],[0,0,254,48,254,51,254,0],[0,0,30,3,3,30,48,28],[7,0,30,51,63,3,30,0],[56,0,30,51,63,3,30,0],[126,195,60,102,126,6,60,0],[51,0,30,51,63,3,30,0],[7,0,14,12,12,12,30,0],[28,0,14,12,12,12,30,0],[62,99,28,24,24,24,60,0],[51,0,14,12,12,12,30,0],[27,14,27,48,62,51,30,0],[0,31,0,31,51,51,51,0],[0,7,0,30,51,51,30,0],[0,56,0,30,51,51,30,0],[30,51,0,30,51,51,30,0],[110,59,0,30,51,51,30,0],[0,51,0,30,51,51,30,0],[24,24,0,126,0,24,24,0],[0,96,60,118,126,110,60,6],[0,7,0,51,51,51,126,0],[0,56,0,51,51,51,126,0],[30,51,0,51,51,51,126,0],[0,51,0,51,51,51,126,0],[0,56,0,51,51,62,48,31],[0,0,6,62,102,62,6,0],[0,51,0,51,51,62,48,31],[45,0,12,12,12,44,24,0],[12,30,51,51,63,51,51,0],[63,102,102,62,102,102,63,0],[63,51,3,3,3,3,3,0],[8,28,28,54,54,99,127,0],[127,70,22,30,22,70,127,0],[127,99,49,24,76,102,127,0],[51,51,51,63,51,51,51,0],[28,54,99,127,99,54,28,0],[30,12,12,12,12,12,30,0],[103,102,54,30,54,102,103,0],[8,28,28,54,54,99,99,0],[99,119,127,127,107,99,99,0],[99,103,111,123,115,99,99,0],[127,99,0,62,0,99,127,0],[28,54,99,99,99,54,28,0],[127,54,54,54,54,54,54,0],[63,102,102,62,6,6,15,0],[0,1,2,4,79,144,160,64],[127,99,6,12,6,99,127,0],[63,45,12,12,12,12,30,0],[51,51,51,30,12,12,30,0],[24,126,219,219,219,126,24,0],[99,99,54,28,54,99,99,0],[219,219,219,126,24,24,60,0],[62,99,99,99,54,54,119,0],[51,0,30,12,12,12,30,0],[51,0,51,51,30,12,30,0],[112,0,110,59,19,59,110,0],[56,0,30,3,14,3,30,0],[56,0,31,51,51,51,51,48],[56,0,12,12,12,44,24,0],[45,0,51,51,51,51,30,0],[0,0,110,59,19,59,110,0],[0,30,51,31,51,31,3,3],[0,0,51,51,30,12,12,0],[56,12,24,62,51,51,30,0],[0,0,30,3,14,3,30,0],[0,63,6,3,3,30,48,28],[0,0,31,51,51,51,51,48],[0,0,30,51,63,51,30,0],[0,0,12,12,12,44,24,0],[0,0,51,27,15,27,51,0],[0,3,6,12,28,54,99,0],[0,0,102,102,102,62,6,3],[0,0,51,51,51,30,12,0],[30,3,14,3,3,30,48,28],[0,0,30,51,51,51,30,0],[0,0,127,54,54,54,54,0],[0,0,60,102,102,54,6,6],[0,0,62,3,3,30,48,28],[0,0,126,27,27,27,14,0],[0,0,126,24,24,88,48,0],[0,0,51,51,51,51,30,0],[0,0,118,219,219,126,24,0],[0,99,54,28,28,54,99,0],[0,0,219,219,219,126,24,0],[0,0,54,99,107,127,54,0],[31,51,51,95,99,243,99,227],[112,216,24,60,24,24,27,14],[60,54,54,124,0,126,0,0],[28,54,54,28,0,62,0,0],[0,0,0,63,3,3,0,0],[48,24,12,24,48,0,126,0],[12,24,48,24,12,0,126,0],[12,24,0,0,0,0,0,0],[14,0,102,102,60,24,24,0],[0,7,0,51,51,62,48,31],[0,0,0,0,255,0,0,0],[0,0,0,255,255,0,0,0],[8,8,8,8,8,8,8,8],[24,24,24,24,24,24,24,24],[0,0,0,0,187,0,0,0],[0,0,0,187,187,0,0,0],[8,0,8,8,8,0,8,8],[24,0,24,24,24,0,24,24],[0,0,0,0,85,0,0,0],[0,0,0,85,85,0,0,0],[0,8,0,8,0,8,0,8],[0,24,0,24,0,24,0,24],[0,0,0,0,248,8,8,8],[0,0,0,248,248,8,8,8],[0,0,0,0,248,24,24,24],[0,0,0,248,248,24,24,24],[0,0,0,0,15,8,8,8],[0,0,0,15,15,8,8,8],[0,0,0,0,31,24,24,24],[0,0,0,31,31,24,24,24],[8,8,8,8,248,0,0,0],[8,8,8,248,248,0,0,0],[24,24,24,24,248,0,0,0],[24,24,24,248,248,0,0,0],[8,8,8,8,15,0,0,0],[8,8,8,15,15,0,0,0],[24,24,24,24,31,0,0,0],[24,24,24,31,31,0,0,0],[8,8,8,8,248,8,8,8],[8,8,8,248,248,8,8,8],[24,24,24,24,248,8,8,8],[8,8,8,8,248,24,24,24],[24,24,24,24,248,24,24,24],[24,24,24,248,248,8,8,8],[8,8,8,248,248,24,24,24],[24,24,24,248,248,24,24,24],[8,8,8,8,15,8,8,8],[8,8,8,15,15,8,8,8],[24,24,24,24,31,8,8,8],[8,8,8,8,31,24,24,24],[24,24,24,24,31,24,24,24],[24,24,24,31,31,8,8,8],[8,8,8,31,31,24,24,24],[24,24,24,31,31,24,24,24],[0,0,0,0,255,8,8,8],[0,0,0,15,255,8,8,8],[0,0,0,248,255,8,8,8],[0,0,0,255,255,8,8,8],[0,0,0,0,255,24,24,24],[0,0,0,31,255,24,24,24],[0,0,0,248,255,24,24,24],[0,0,0,255,255,24,24,24],[8,8,8,8,255,0,0,0],[8,8,8,15,255,0,0,0],[8,8,8,248,255,0,0,0],[8,8,8,255,255,0,0,0],[24,24,24,24,255,0,0,0],[24,24,24,31,255,0,0,0],[24,24,24,248,255,0,0,0],[24,24,24,255,255,0,0,0],[8,8,8,8,255,8,8,8],[8,8,8,15,255,8,8,8],[8,8,8,248,255,8,8,8],[8,8,8,255,255,8,8,8],[24,24,24,24,255,8,8,8],[8,8,8,8,255,24,24,24],[24,24,24,24,255,24,24,24],[24,24,24,31,255,8,8,8],[24,24,24,248,255,8,8,8],[8,8,8,31,255,24,24,24],[8,8,8,248,255,24,24,24],[8,8,8,255,255,24,24,24],[24,24,24,255,255,8,8,8],[24,24,24,248,255,24,24,24],[24,24,24,31,255,24,24,24],[24,24,24,255,255,24,24,24],[0,0,0,0,231,0,0,0],[0,0,0,231,231,0,0,0],[8,8,8,0,0,8,8,8],[24,24,24,0,0,24,24,24],[0,0,0,255,0,255,0,0],[20,20,20,20,20,20,20,20],[0,0,0,248,8,248,8,8],[0,0,0,0,252,20,20,20],[0,0,0,252,4,244,20,20],[0,0,0,15,8,15,8,8],[0,0,0,0,31,20,20,20],[0,0,0,31,16,23,20,20],[8,8,8,248,8,248,0,0],[20,20,20,20,252,0,0,0],[20,20,20,244,4,252,0,0],[8,8,8,15,8,15,0,0],[20,20,20,20,31,0,0,0],[20,20,20,23,16,31,0,0],[8,8,8,248,8,248,8,8],[20,20,20,20,244,20,20,20],[20,20,20,244,4,244,20,20],[8,8,8,15,8,15,8,8],[20,20,20,20,23,20,20,20],[20,20,20,23,16,23,20,20],[0,0,0,255,0,255,8,8],[0,0,0,0,255,20,20,20],[0,0,0,255,0,247,20,20],[8,8,8,255,0,255,0,0],[20,20,20,20,255,0,0,0],[20,20,20,247,0,255,0,0],[8,8,8,255,8,255,8,8],[20,20,20,20,255,20,20,20],[20,20,20,247,0,247,20,20],[0,0,0,0,224,16,8,8],[0,0,0,0,3,4,8,8],[8,8,8,4,3,0,0,0],[8,8,8,16,224,0,0,0],[128,64,32,16,8,4,2,1],[1,2,4,8,16,32,64,128],[129,66,36,24,24,36,66,129],[0,0,0,0,15,0,0,0],[8,8,8,8,0,0,0,0],[0,0,0,0,248,0,0,0],[0,0,0,0,8,8,8,8],[0,0,0,15,15,0,0,0],[24,24,24,24,0,0,0,0],[0,0,0,248,248,0,0,0],[0,0,0,0,24,24,24,24],[0,0,0,248,255,0,0,0],[8,8,8,8,24,24,24,24],[0,0,0,15,255,0,0,0],[24,24,24,24,8,8,8,8],[255,255,255,255,0,0,0,0],[0,0,0,0,0,0,0,255],[0,0,0,0,0,0,255,255],[0,0,0,0,0,255,255,255],[0,0,0,0,255,255,255,255],[0,0,0,255,255,255,255,255],[0,0,255,255,255,255,255,255],[0,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255],[127,127,127,127,127,127,127,127],[63,63,63,63,63,63,63,63],[31,31,31,31,31,31,31,31],[15,15,15,15,15,15,15,15],[7,7,7,7,7,7,7,7],[3,3,3,3,3,3,3,3],[1,1,1,1,1,1,1,1],[240,240,240,240,240,240,240,240],[85,0,170,0,85,0,170,0],[85,170,85,170,85,170,85,170],[255,170,255,85,255,170,255,85],[255,0,0,0,0,0,0,0],[128,128,128,128,128,128,128,128],[0,0,0,0,15,15,15,15],[0,0,0,0,240,240,240,240],[15,15,15,15,0,0,0,0],[15,15,15,15,255,255,255,255],[15,15,15,15,240,240,240,240],[255,255,255,255,15,15,15,15],[255,255,255,255,240,240,240,240],[240,240,240,240,0,0,0,0],[240,240,240,240,15,15,15,15],[240,240,240,240,255,255,255,255],[0,0,0,0,0,0,0,0],[4,63,4,60,86,77,38,0],[4,63,4,60,86,77,38,0],[0,0,0,17,33,37,2,0],[0,1,17,33,33,37,2,0],[0,28,0,28,34,32,24,0],[60,0,60,66,64,32,24,0],[28,0,62,16,56,36,98,0],[28,0,62,16,56,36,98,0],[36,79,4,60,70,69,34,0],[36,79,4,60,70,69,34,0],[4,36,79,84,82,18,9,0],[68,36,15,84,82,82,9,0],[8,31,8,63,28,2,60,0],[68,47,4,31,14,1,30,0],[16,8,4,2,4,8,16,0],[40,68,18,33,2,4,8,0],[0,34,121,33,33,34,16,0],[64,34,17,61,17,18,8,0],[0,0,60,0,2,2,60,0],[32,64,22,32,1,1,14,0],[16,126,16,60,2,2,28,0],[36,79,20,46,1,1,14,0],[0,2,2,2,66,34,28,0],[32,66,18,34,2,34,28,0],[16,126,24,20,24,16,12,0],[68,47,6,5,6,4,3,0],[32,114,47,34,26,2,28,0],[128,80,58,23,26,2,28,0],[30,8,4,127,8,4,56,0],[79,36,2,127,8,4,56,0],[2,15,2,114,2,9,113,0],[66,47,2,114,2,9,113,0],[8,126,8,60,64,64,56,0],[68,47,4,30,32,32,28,0],[0,0,0,28,34,32,28,0],[0,28,34,65,64,32,28,0],[64,32,30,33,32,32,28,0],[0,62,8,4,4,4,56,0],[0,62,72,36,4,4,56,0],[4,4,8,60,2,2,60,0],[68,36,8,60,2,2,60,0],[50,2,39,34,114,41,17,0],[0,2,122,2,10,114,2,0],[8,9,62,75,101,85,34,0],[4,7,52,76,102,84,36,0],[0,0,60,74,73,69,34,0],[0,34,122,34,114,42,18,0],[128,81,29,17,57,21,9,0],[64,177,93,17,57,21,9,0],[0,0,19,50,81,17,14,0],[64,32,3,50,81,17,14,0],[64,160,67,50,81,17,14,0],[28,0,8,42,73,16,12,0],[76,32,8,42,73,16,12,0],[76,160,72,10,41,72,12,0],[0,0,4,10,17,32,64,0],[32,64,20,42,17,32,64,0],[32,80,36,10,17,32,64,0],[125,17,125,17,57,85,9,0],[157,81,29,17,57,85,9,0],[93,177,93,17,57,85,9,0],[126,8,62,8,28,42,4,0],[0,7,36,36,126,37,18,0],[4,15,100,6,5,38,60,0],[0,9,61,74,75,69,42,0],[2,15,2,15,98,66,60,0],[0,0,18,31,34,18,4,0],[0,18,63,66,66,52,4,0],[0,0,17,61,83,57,17,0],[0,17,61,83,81,57,17,0],[0,8,56,8,28,42,4,0],[8,8,56,8,28,42,4,0],[30,0,2,58,70,66,48,0],[0,32,34,34,42,36,16,0],[31,8,60,66,73,84,56,0],[4,7,4,12,22,85,36,0],[63,16,8,60,66,65,48,0],[0,0,8,14,56,76,42,0],[4,7,4,60,70,69,36,0],[14,8,60,74,105,85,50,0],[6,60,66,57,4,54,73,0],[4,15,4,110,17,8,112,0],[8,8,4,12,86,82,33,0],[64,46,0,60,66,64,56,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[64,128,32,64,0,0,0,0],[64,160,64,0,0,0,0,0],[0,0,8,8,16,48,12,0],[32,64,20,36,8,24,6,0],[0,0,0,0,0,0,0,0],[0,0,56,102,6,6,7,0],[0,0,12,12,24,48,127,0],[0,0,12,0,12,48,48,0],[0,0,127,0,3,28,96,0],[0,0,99,3,3,3,127,0],[0,0,0,255,0,219,0,0],[0,0,48,48,62,48,48,0],[0,0,126,0,126,24,24,0],[0,0,24,24,0,24,24,0],[0,0,24,0,24,0,24,0],[0,0,24,24,90,24,24,0],[0,0,3,51,3,51,3,0],[0,0,99,96,96,96,127,0],[0,0,102,96,48,24,12,0],[0,0,60,96,48,24,12,0],[0,0,102,96,102,6,102,0],[0,0,24,0,126,96,126,0],[0,0,0,102,0,102,0,0],[0,0,12,12,60,48,48,0],[0,0,60,48,48,0,48,0],[0,0,0,54,0,127,0,0],[0,0,24,24,126,0,126,0],[0,0,0,24,0,102,0,0],[0,0,102,48,24,12,6,0],[0,0,54,54,54,54,54,0],[0,0,24,60,102,102,102,0]];var a0=8,G=8,c0=(e,x,r,t)=>{let n=x.charCodeAt(0),i=F[n];if(i)for(let s=0;s<a0;s++){let o=i[s];if(o!==void 0)for(let a=0;a<G;a++)o&1<<a&&e.fillRect(r+a,t+s,1,1);}},P=(e,x,r,t)=>{for(let n=0;n<x.length;n++){let i=x[n];i!==void 0&&c0(e,i,r+n*G,t);}};var y=e=>e.trim().replace(/[ \t]/gm,"").split(/\n+/gm),N=e=>{let x=e.length;return [Math.max(...e.map(t=>t.length)),x]},v=(e,x)=>{let r=new RegExp(`(.{1,${x}})( +|$\\n?)|(.{1,${x}})|(
)`,"gm");return Array.from(e.match(r)??[])},U=e=>{try{return new URL(e),!0}catch{return !1}};var C=class{#x;#e;#s;#t;#r=[];#i=0;#n;#o;#m=0;#p=50;isOpen=!1;#a=2;#l;#d;#y=20;#b=8;#T=8;#P=8;#h;#u;#c;#f;constructor(x){this.#l=x.dialogBackground,this.#d=x.dialogColor,this.#x=document.createElement("canvas"),this.#x.style.setProperty("position","absolute"),this.#x.style.setProperty("box-sizing","border-box"),this.#x.style.setProperty("display","none"),this.#x.style.setProperty("image-rendering","crisp-edges"),this.#x.style.setProperty("image-rendering","pixelated"),this.#e=this.#x.getContext("2d"),this.#x.width=256,this.#x.height=256,this.#S(),document.body.append(this.#x),window.addEventListener("resize",this.#S),this.#h=this.#a*8+this.#T*2+this.#b*(this.#a-1),this.#f=this.#x.height-this.#h-16,this.#u=this.#y*8+this.#P*2,this.#c=(this.#x.width-this.#u)*.5;}async open(x){return this.#x.style.setProperty("display","block"),this.#t=v(x,this.#y),this.#n=this.#t.shift()?.split(""),this.#o=requestAnimationFrame(this.#v),this.isOpen=!0,this.#r=new Array(this.#a).fill(""),this.#g(),new Promise(r=>{this.#s=()=>r();})}next(){if(this.isOpen&&(this.#n?.length===0||this.#n===void 0)){if(this.#n=this.#t?.shift()?.split(""),this.#n===void 0){this.#w();return}this.#i++,this.#i>=this.#a&&(this.#i=0,this.#r=this.#r.map(()=>""),this.#g());}}#v=x=>{if(this.#o=requestAnimationFrame(this.#v),x-this.#m<this.#p)return;this.#m=x,this.#n?.length===0&&this.#i<this.#a-1&&(this.#i++,this.#n=this.#t?.shift()?.split(""));let r=this.#n?.shift();this.#e.fillStyle=this.#d,r&&(this.#r[this.#i]=this.#r[this.#i]+r,this.#g());};#w(){this.isOpen=!1,this.#x.style.setProperty("display","none"),this.#i=0,this.#s?.(),this.#o&&cancelAnimationFrame(this.#o);}#S=()=>{let x=Math.min(window.innerWidth,window.innerHeight),r=(window.innerWidth-x)*.5,t=(window.innerHeight-x)*.5;this.#x.style.setProperty("width",`${x}px`),this.#x.style.setProperty("height",`${x}px`),this.#x.style.setProperty("left",`${r}px`),this.#x.style.setProperty("top",`${t}px`);};#g=()=>{this.#e.clearRect(0,0,this.#x.width,this.#x.height),this.#e.fillStyle=this.#l,this.#e.fillRect(this.#c,this.#f,this.#u,this.#h),this.#e.fillStyle=this.#d;for(let x=0;x<this.#u;x++)this.#e.fillRect(this.#c+x,this.#f,1,1),this.#e.fillRect(this.#c+x,this.#f+this.#h-1,1,1);for(let x=0;x<this.#h;x++)this.#e.fillRect(this.#c,this.#f+x,1,1),this.#e.fillRect(this.#c+this.#u-1,this.#f+x,1,1);this.#e.fillStyle=this.#d,this.#r.forEach((x,r)=>{let t=this.#c+this.#P,n=this.#f+this.#T+8*r+r*this.#b;P(this.#e,x,t,n);});}},q=e=>new C(e);var B=({gameState:e,messageBox:x,camera:r})=>({play:async t=>{t&&await x.open(t),r.reset(),e.player.restoreSavedState(),e.actors.reset();}});var k={waveForm:[{name:"waveForm",defaultValue:0,type:"radio",options:[{value:0,label:"Sine"},{value:1,label:"SawTooth"},{value:2,label:"Square"},{value:3,label:"Triangle"}]}],volume:[{name:"volume",min:0,max:1,step:.01,type:"range",defaultValue:.5}],soundEnveloppe:[{name:"attackTime",min:0,max:2,step:.01,type:"range",defaultValue:0},{name:"sustainTime",min:0,max:2,step:.01,type:"range",defaultValue:.07},{name:"sustainPunch",min:0,max:1,step:.01,type:"range",defaultValue:0},{name:"decayTime",min:0,max:2,step:.01,type:"range",defaultValue:.3}],pitch:[{name:"frequency",min:0,max:4e3,step:1,type:"range",defaultValue:700},{name:"pitchDelta",min:-4e3,max:4e3,step:1,type:"range",defaultValue:0},{name:"pitchDuration",min:0,max:1,step:.01,type:"range",defaultValue:1},{name:"pitchDelay",min:0,max:1,step:.01,type:"range",defaultValue:0}],vibrato:[{name:"vibratoRate",min:0,max:70,step:1,type:"range",defaultValue:0},{name:"vibratoDepth",min:0,max:100,step:1,type:"range",defaultValue:0}],tremolo:[{name:"tremoloRate",min:0,max:70,step:1,type:"range",defaultValue:0},{name:"tremoloDepth",min:0,max:1,step:.01,type:"range",defaultValue:0}],filters:[{name:"highPassCutoff",min:0,max:4e3,step:.1,type:"range",defaultValue:0},{name:"highPassResonance",min:0,max:30,step:.1,type:"range",defaultValue:0},{name:"lowPassCutoff",min:0,max:4e3,step:.1,type:"range",defaultValue:4e3},{name:"lowPassResonance",min:0,max:30,step:.1,type:"range",defaultValue:0}],phaser:[{name:"phaserBaseFrequency",min:0,max:1e3,step:1,type:"range",defaultValue:100},{name:"phaserLfoFrequency",min:0,max:200,step:1,type:"range",defaultValue:50},{name:"phaserDepth",min:0,max:1e3,step:1,type:"range",defaultValue:0}],noise:[{name:"noiseAmount",min:0,max:500,step:1,type:"range",defaultValue:0}]},b=Object.values(k).flatMap(e=>[...e]),S=b.reduce((e,x)=>({...e,[x.name]:x.defaultValue}),{}),f0=(e,{noiseAmount:x})=>{let r=e.createWaveShaper(),t=44100,n=new Float32Array(t),i=Math.PI/180;for(let s=0;s<t;s++){let o=s*2/t-1;n[s]=(3+Math.random()*x)*o*20*i/(Math.PI+Math.random()*x*Math.abs(o));}return r.curve=n,r.oversample="4x",{input:r,output:r}},l0=(e,{attackTime:x,sustainTime:r,sustainPunch:t,decayTime:n})=>{let i=e.createGain(),s=e.currentTime;return i.gain.setValueAtTime(0,s),i.gain.linearRampToValueAtTime(1-t,s+x),i.gain.setValueAtTime(1,s+x),i.gain.linearRampToValueAtTime(1-t,s+x+r),i.gain.linearRampToValueAtTime(0,s+x+r+n),{input:i,output:i}},h0=(e,{highPassCutoff:x,highPassResonance:r})=>{let t=e.createBiquadFilter();return t.type="highpass",t.frequency.value=x,t.Q.value=r,{input:t,output:t}},u0=(e,{lowPassCutoff:x,lowPassResonance:r})=>{let t=e.createBiquadFilter();return t.type="lowpass",t.frequency.value=x,t.Q.value=r,{input:t,output:t}},m0=(e,x,r)=>Math.min(Math.max(e,x),r),p0=(e,x)=>Math.round(e*10**x)/10**x,d0=["sine","sawtooth","square","triangle"],g0=k.pitch[0].max,y0=(e,x,{waveForm:r,frequency:t,pitchDelta:n,pitchDuration:i,pitchDelay:s})=>{let o=x*s,a=(x-o)*i,c=e.createOscillator();return c.type=d0[r]??"sine",c.frequency.setValueAtTime(t,e.currentTime),c.frequency.linearRampToValueAtTime(t,e.currentTime+o),c.frequency.linearRampToValueAtTime(m0(0,t+n,g0),e.currentTime+o+a),{input:c,output:c,start:()=>c.start(),stop:l=>c.stop(l)}},b0=(e,{phaserBaseFrequency:x,phaserLfoFrequency:r,phaserDepth:t})=>{let n=e.createBiquadFilter();n.type="allpass",n.frequency.value=x;let i=e.createOscillator();i.type="sine",i.frequency.value=r;let s=e.createGain();return s.gain.value=t,i.connect(s),s.connect(n.frequency),{input:n,output:n,start:()=>i.start(),stop:o=>i?.stop(o)}},$=(e,x,r)=>{let t=e.createOscillator(),n=e.createGain();return t.frequency.value=r,n.gain.value=x,t.connect(n),{input:t,output:n,start:()=>t.start(),stop:i=>t.stop(i)}},T0=(e,{tremoloDepth:x,tremoloRate:r})=>$(e,x,r),P0=(e,{vibratoDepth:x,vibratoRate:r})=>$(e,x,r),v0=(e,{volume:x})=>{let r=e.createGain();return r.gain.value=x,{input:r,output:r}},z=(e,x,r)=>{let t=Object.assign({},S,e),n=t.attackTime+t.sustainTime+t.decayTime,i=y0(x,n,t),s=f0(x,t),o=l0(x,t),a=P0(x,t),c=T0(x,t),l=u0(x,t),w=h0(x,t),f=b0(x,t),h=v0(x,t);a.output.connect(i.input.frequency),c.output.connect(o.input),i.output.connect(s.input),s.output.connect(f.input),f.output.connect(l.input),l.output.connect(w.input),w.output.connect(o.input),o.output.connect(h.input),h.output.connect(r);let p=[a,c,i,f,l,o];return new Promise(u=>{p.forEach(m=>{m.start?.(),m.stop?.(x.currentTime+n);}),i.output.onended=()=>u();})},X=e=>{let x={...S},r=e.searchParams.get("fx");if(!r)return x;let t=decodeURI(r).split(",");for(let n=0;n<b.length;n++){let i=b[n]?.name,s=t[n];i&&s&&!isNaN(Number(s))&&(x[i]=Number(s));}return x};var S0=class{seed;#x;#e;#s;#t;constructor(e){this.seed=e??Date.now(),this.#x=this.seed&4294967295,this.#e=362436069,this.#s=521288629,this.#t=88675123;for(let x=0;x<32;x++)this.#r();}#r(){let e=this.#x^this.#x<<11&4294967295;return this.#x=this.#e,this.#e=this.#s,this.#s=this.#t,this.#t=this.#t^this.#t>>>19^(e^e>>>8),this.#t+2147483648}number(e,x){return e===void 0?(e=0,x=1):x===void 0&&(x=e,e=0),e+(x-e)*this.#r()/4294967295}boolean(e=.5){return this.number(0,1)<e}fromArray(e){return e[Math.floor(this.number(0,e.length))]}},w0=e=>(b.forEach(x=>{let r=e[x.name];if(x.type==="range"&&r){let t=x.step.toString().split(".")[1]?.length??0;e[x.name]=p0(r,t);}}),Object.assign({},S,e)),Y=(e,x)=>w0(e(new S0(x))),E={DEFAULT:()=>({}),PICKUP:e=>({...e.boolean()?{pitchDelta:e.number(100,500),pitchDuration:0,pitchDelay:e.number(0,.7)}:{},waveForm:e.fromArray([0,1,2,3]),sustainPunch:e.number(0,.8),sustainTime:e.number(.05,.2),decayTime:e.number(.1,.3),frequency:e.number(900,1700)}),LASER:e=>{let x=e.number(100,1300);return {waveForm:e.fromArray([0,1,2,3]),sustainPunch:e.number(0,.8),sustainTime:e.number(.05,.1),decayTime:e.number(0,.2),frequency:x,pitchDelta:e.number(-x,-100),pitchDuration:1,pitchDelay:e.fromArray([0,e.number(0,.3)])}},JUMP:e=>({waveForm:e.fromArray([1,2]),sustainPunch:e.number(0,.8),sustainTime:e.number(.2,.5),decayTime:e.number(.1,.2),frequency:e.number(100,500),pitchDelta:e.number(200,500),pitchDuration:1,pitchDelay:e.fromArray([0,e.number(0,.3)])}),FALL:e=>{let x=e.number(80,500);return {waveForm:e.fromArray([1,2,3]),sustainPunch:0,sustainTime:e.number(.2,.5),decayTime:e.number(.2,.5),frequency:x,pitchDelta:-x,pitchDuration:1,pitchDelay:e.number(0,.2),vibratoRate:e.number(8,18),vibratoDepth:e.number(10,30),tremoloRate:e.number(5,18),tremoloDepth:e.number(0,1)}},POWERUP:e=>({waveForm:e.fromArray([0,1,2,3]),sustainPunch:e.number(0,1),sustainTime:e.number(.2,.5),decayTime:e.number(.1,.5),frequency:e.number(200,1e3),pitchDelta:e.number(100,300),pitchDuration:1,pitchDelay:e.fromArray([0,e.number(0,.3)]),vibratoRate:e.number(10,18),vibratoDepth:e.number(50,100)}),EXPLOSION:e=>{let x=e.number(200);return {waveForm:e.fromArray([0,1,2,3]),volume:.3,sustainPunch:e.number(0,.3),sustainTime:e.number(.4,1.3),decayTime:e.number(.1,.5),frequency:x,pitchDelta:-x,pitchDuration:1,pitchDelay:e.number(.3),vibratoRate:e.number(0,70),vibratoDepth:e.number(0,100),tremoloRate:e.number(0,70),tremoloDepth:e.number(0,1),phaserDepth:e.number(300,1e3),noiseAmount:e.number(300,500)}},BLIP:e=>({waveForm:e.fromArray([0,1,2,3]),sustainTime:e.number(.02,.1),decayTime:e.number(0,.04),frequency:e.number(600,3e3)}),HIT:e=>{let x=e.number(20,500);return {waveForm:e.fromArray([0,1,2,3]),sustainTime:e.number(.01,.03),sustainPunch:e.number(.5),decayTime:e.number(0,.2),frequency:x,pitchDelta:e.number(-x,-x*.2),noiseAmount:e.number(100)}},FART:e=>{let x=e.number(30,150);return {waveForm:1,volume:.7,sustainPunch:e.number(0,.2),sustainTime:e.number(.1,.5),decayTime:e.number(.3,.5),frequency:x,pitchDelta:-x/2,pitchDuration:1,pitchDelay:.1,vibratoRate:e.number(8,18),vibratoDepth:e.number(10,30),tremoloRate:e.number(35,70),tremoloDepth:e.number(.6,1),lowPassCutoff:x*10,lowPassResonance:10,noiseAmount:e.number(0,30)}},RANDOM:e=>{let x={...S};for(let r=0;r<b.length;r++){let t=b[r];t&&(t.type==="range"?x[t.name]=e.number(t.min,t.max):t.type==="radio"&&(x[t.name]=e.fromArray(t.options.map(n=>n.value))));}return x}};var j=(...e)=>e.reduce((x,r)=>[x[0]+r[0],x[1]+r[1]],[0,0]),d=(...e)=>!e.some((x,r)=>{let t=e[r-1];return t?t[0]!==x[0]||t[1]!==x[1]:!1});var T=e=>{let x=0,r=e,t=new Map;return {subscribe:n=>{let i=x;return x++,t.set(i,n),n(r),()=>{t.delete(i);}},set:n=>{r=n,t.forEach(i=>{i(r);});},get:()=>r,update:n=>{r=n(r),t.forEach(i=>{i(r);});}}};var D=class{audioContext;gainNode;playing=!1;constructor(x){this.audioContext=new AudioContext,this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=x.volume,this.gainNode.connect(this.audioContext.destination);}async play(x){if(!this.playing)return this.playing=!0,z(x,this.audioContext,this.gainNode).then(()=>{this.playing=!1;})}},_=e=>new D(e),M=(...e)=>{let[x,r]=e;return U(x)?X(new URL(x)):x in E?Y(E[x],r):{}};var K=(e,x,r,t,n)=>({player:e.player.playerProxy,getCell:e.actors.getCell,addToCell:e.actors.addToCell,setCell:e.actors.setCell,getAll:e.actors.getAll,setAll:e.actors.setAll,openDialog:s=>x.open(s),openMessage:s=>n.open(s),playSound:(...s)=>{let[o]=s;return typeof o=="object"?r.play(o):r.play(M(...s))},end:s=>t.play(s),loadMap:(s,o)=>{o&&(e.player.playerProxy.position=[...o]),e.mapStore.store.set(s),e.player.saveCurrentState();},get width(){return e.mapStore.getDimensions()[0]},get height(){return e.mapStore.getDimensions()[1]}});var R=class{gameState;soundPlayer;dialog;ender;constructor(x){this.gameState=x.gameState,this.soundPlayer=x.soundPlayer,this.dialog=x.dialog,this.ender=x.ender;}async update(x){let r=this.gameState.player.playerProxy.position,t=j(r,A0[x]);if(!this.isCellOnScreen(t))return;let n=this.gameState.actors.getCell(...r),i=this.gameState.actors.getCell(...t),s=i.sound;s&&this.soundPlayer.play(s);let o=i.end;if(i.solid){let a=i.dialog;a&&await this.dialog.open(a),await this.gameState.actors._eventsListeners.get(i.symbol??"")?.onCollide?.(i);}else if(n&&this.gameState.actors._eventsListeners.get(n.symbol??"")?.onLeave?.(n),d(r,this.gameState.player.playerProxy.position)&&(this.gameState.player.playerProxy.position=t),i){let a=i?.dialog;a?this.dialog.open(a).then(()=>{this.gameState.actors._eventsListeners.get(i.symbol??"")?.onEnter?.(i);}):this.gameState.actors._eventsListeners.get(i.symbol??"")?.onEnter?.(i);}o&&await this.ender.play(o);}isCellOnScreen([x,r]){return x>=0&&r>=0&&x<this.gameState.mapStore.getDimensions()[0]&&r<this.gameState.mapStore.getDimensions()[1]}getActorOnCell(x,r){return x.find(({position:t})=>t[0]===r[0]&&t[1]===r[1])}},A0={LEFT:[-1,0],RIGHT:[1,0],UP:[0,-1],DOWN:[0,1],ACTION:[0,0]},Q=e=>new R(e);var H=(e,x)=>{let r=[];x.subscribe(s=>r=s);let t=()=>r.find(s=>d(s.position,e)),n=(s,o)=>{x.update(a=>{for(let c=0;c<a.length;c++){let l=a[c];!l||a[c]===void 0||!d(l.position,e)||(a[c][s]=o);}return a});};return {get sprite(){return t()?.sprite??null},set sprite(s){n("sprite",s);},get solid(){return t()?.solid??!1},set solid(s){n("solid",s);},get sound(){return t()?.sound??null},set sound(s){n("sound",s);},get position(){return t()?.position??[-1,-1]},get dialog(){return t()?.dialog??null},set dialog(s){n("dialog",s);},get visible(){return t()?.visible??!1},set visible(s){n("visible",s);},get end(){return t()?.end??null},set end(s){n("end",s);},get symbol(){return t()?.symbol??null},remove:()=>{x.update(s=>s.filter(o=>!d(o.position,e)));}}};var Z=(e,x)=>{let r=e.templates,t=new Map;for(let f in r){let h=r[f];h&&t.set(f,{onCollide:h.onCollide,onEnter:h.onEnter,onLeave:h.onLeave});}let n=[],i=T(n);return i.subscribe(f=>{n=f;}),x.store.subscribe(f=>{i.set(J(y(f),r));}),{getCell:(f,h)=>H([f,h],i),setCell:(f,h,p)=>{i.update(u=>{for(let m=0;m<u.length;m++){let g=u[m];if(!g||!g.position||!d(g.position,[f,h]))continue;let o0=Object.assign({},g,p);u[m]=o0;}return u});},getAll:f=>n.filter(h=>h.symbol===f).map(h=>H(h.position,i)),setAll:(f,h)=>{i.update(p=>{for(let u=0;u<p.length;u++){let m=p[u];if(m?.symbol!==f)continue;let g=Object.assign({},m,h);p[u]=g;}return p});},addToCell:(f,h,p)=>{let u=r[p];u&&i.update(m=>[...m.filter(g=>!d([f,h],g.position)),x0(f,h,p,u)]);},reset:()=>i.set(J(y(x.store.get()),r)),_store:i,_eventsListeners:t}},J=(e,x)=>{let r=[];for(let t=0;t<e.length;t++){let n=e[t];if(n)for(let i=0;i<n.length;i++){let s=n[i];if(!s)continue;let o=x[s];o&&r.push(x0(i,t,s,o));}}return r},x0=(e,x,r,t)=>({symbol:r,sprite:t.sprite??null,position:[e,x],dialog:t.dialog??null,end:t.end??null,sound:t.sound??null,solid:t.solid!==!1,visible:t.visible!==!1});var e0=e=>{let x=T(e),r=[0,0];return x.subscribe(t=>{r=N(y(t));}),{store:x,getDimensions(){return r}}};var t0=e=>{let x=e.sprite??null,r=e.position??[0,0],t=e.sprite??null,n=e.position??[0,0],i=T({sprite:t,position:n});return i.subscribe(c=>{t=c.sprite??null,n=c.position;}),{playerProxy:{get sprite(){return t},set sprite(c){i.set({sprite:c,position:n});},get position(){return n},set position(c){i.set({sprite:t,position:c});}},playerStore:i,restoreSavedState:()=>{i.set({sprite:x,position:r});},saveCurrentState:()=>{x=t,r=[...n];}}};var r0=e=>{let x=e0(e.map),r=t0(e.player),t=Z(e,x);return {player:r,actors:t,mapStore:x}};var I=class{controls;lastKeysEvents=new Map;onInput;lastTouchEvent=0;oldTouchX;oldTouchY;isTouching=!1;constructor(x,r){this.controls=Object.entries(x.controls),this.onInput=r;let t=document.createElement("div");t.style.setProperty("position","absolute"),t.style.setProperty("left","0"),t.style.setProperty("height","0"),t.style.setProperty("width","100vw"),t.style.setProperty("height","100vh"),t.style.setProperty("overflow","hidden"),document.body.appendChild(t),document.body.style.setProperty("margin","0"),document.addEventListener("keydown",this.handleKeydown),t.addEventListener("touchstart",this.handleTouch),t.addEventListener("touchend",this.handleTouchLeave),t.addEventListener("touchcancel",this.handleTouchLeave),t.addEventListener("touchmove",this.handleTouchMove);}handleTouch=x=>{x.preventDefault(),this.isTouching||this.onInput("ACTION"),this.isTouching=!0,this.oldTouchX=x.changedTouches[0]?.clientX,this.oldTouchY=x.changedTouches[0]?.clientY;};handleTouchLeave=x=>{x.preventDefault(),this.isTouching=!1;};handleTouchMove=x=>{x.preventDefault();let r=x.changedTouches[0]?.clientX,t=x.changedTouches[0]?.clientY;if(r===void 0||t===void 0||this.oldTouchX===void 0||this.oldTouchY===void 0)return;let n=r-this.oldTouchX,i=t-this.oldTouchY,s=x.timeStamp;if(!(Math.abs(n)<4&&Math.abs(i)<4)&&!(s-this.lastTouchEvent<200))if(this.lastTouchEvent=s,this.oldTouchX=r,this.oldTouchY=t,Math.abs(i)>Math.abs(n)){let o=Math.sign(i);this.onInput(o<0?"UP":"DOWN");}else {let o=Math.sign(n);this.onInput(o<0?"LEFT":"RIGHT");}};handleKeydown=x=>{let r=this.controls.find(([s,o])=>o===x.code||o.includes(x.code));if(!r)return;let[t]=r,n=x.timeStamp,i=this.lastKeysEvents.get(x.code);x.repeat&&i&&n-i<200||(this.lastKeysEvents.set(x.code,n),this.onInput(t));}},i0=(e,x)=>new I(e,x);var W=class{#x;#e;isOpen=!1;#s;#t=[];#r=0;#i;#n;#o=192;#m=8;#p=2;constructor(x){this.#i=x.messageBackground,this.#n=x.messageColor,this.#x=document.createElement("canvas"),this.#x.style.setProperty("position","absolute"),this.#x.style.setProperty("box-sizing","border-box"),this.#x.style.setProperty("display","none"),this.#x.style.setProperty("image-rendering","crisp-edges"),this.#x.style.setProperty("image-rendering","pixelated"),this.#e=this.#x.getContext("2d"),this.#x.width=this.#o,this.#x.height=this.#o,this.#a(),window.addEventListener("resize",this.#a),document.body.append(this.#x);}#a=()=>{let x=Math.min(window.innerWidth,window.innerHeight),r=(window.innerWidth-x)*.5,t=(window.innerHeight-x)*.5;this.#x.style.setProperty("width",`${x}px`),this.#x.style.setProperty("height",`${x}px`),this.#x.style.setProperty("left",`${r}px`),this.#x.style.setProperty("top",`${t}px`);};open(x){this.isOpen=!0,this.#t=typeof x=="string"?[x]:[...x];let r=this.#t[this.#r];if(r)return this.#x.style.removeProperty("display"),this.#l(r),new Promise(t=>this.#s=()=>t())}next(){this.#r++;let x=this.#t[this.#r];x?this.#l(x):this.close();}#l(x){this.#e.clearRect(0,0,this.#x.width,this.#x.height);let r=(this.#o-2*this.#m)/8,t=v(x,r);this.#e.fillStyle=this.#i,this.#e.fillRect(0,0,this.#x.width,this.#x.height),this.#e.fillStyle=this.#n;let n=t.length*8+(t.length-1)*this.#p,i=(this.#x.height-n)*.5;t.forEach((s,o)=>{let a=s.length*8,c=(this.#x.width-a)*.5,l=i+o*8+o*this.#p;P(this.#e,s,c,l);});}close=()=>{this.#r=0,this.isOpen=!1,this.#x.style.setProperty("display","none"),this.#s?.();}},n0=e=>new W(e);var L=class{canvas;screenWidth;screenHeight;cellWidth;cellHeight;colors;ctx;background;constructor(x){this.screenWidth=x.screenWidth,this.screenHeight=x.screenHeight,this.cellWidth=x.cellWidth,this.cellHeight=x.cellHeight,this.colors=x.colors,this.background=x.background,this.canvas=document.createElement("canvas"),this.canvas.width=this.cellWidth*x.screenWidth,this.canvas.height=this.cellHeight*x.screenHeight,this.canvas.style.setProperty("position","absolute"),this.canvas.style.setProperty("image-rendering","crisp-edges"),this.canvas.style.setProperty("image-rendering","pixelated");let r=this.canvas.getContext("2d");if(!r)throw new Error("failled to access context of the canvas");this.ctx=r,this.#x(),document.body.append(this.canvas),window.addEventListener("resize",this.#x);}#x=()=>{let x=this.canvas.width<this.canvas.height?"vertical":"horizontal",r=Math.min(window.innerWidth,window.innerHeight),t=x==="horizontal"?r:r/this.canvas.height*this.canvas.width,n=x==="vertical"?r:r/this.canvas.width*this.canvas.height,i=(window.innerWidth-t)*.5,s=(window.innerHeight-n)*.5;this.canvas.style.setProperty("width",`${t}px`),this.canvas.style.setProperty("height",`${n}px`),this.canvas.style.setProperty("left",`${i}px`),this.canvas.style.setProperty("top",`${s}px`);};render(x,r){this.clear();let[t,n]=r;for(let i of x){if(i.sprite===void 0||i.sprite===null||i.visible===!1)continue;let[s,o]=i.position,a=(s-t)*this.cellWidth,c=(o-n)*this.cellHeight;this.drawTile(i.sprite,a,c);}}clear(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.background!==void 0&&(typeof this.background=="number"?this.ctx.fillStyle=this.colors[this.background]??this.colors[0]??"black":this.ctx.fillStyle=this.background,this.ctx.fillRect(0,0,this.screenWidth*this.cellWidth,this.screenHeight*this.cellHeight));}drawTile(x,r,t){if(r+this.cellWidth<0||t+this.cellHeight<0||r>this.screenWidth*this.cellWidth||t>this.screenHeight*this.cellHeight)return;if(typeof x=="number"){let i=this.colors[x];if(!i)return;this.ctx.fillStyle=i,this.ctx.fillRect(Math.floor(r),Math.floor(t),this.cellWidth,this.cellHeight);return}let n=y(x);for(let i=0;i<this.cellHeight;i++)for(let s=0;s<this.cellWidth;s++){let o=n[i]?.charAt(s);if(!o)continue;let a=+o;if(isNaN(a))continue;let c=this.colors[a];c&&(this.ctx.fillStyle=c,this.ctx.fillRect(Math.floor(r+s),Math.floor(t+i),1,1));}}},s0=e=>new L(e);var C0=e=>{let x=Object.assign({},V,e),r=r0(x),t=_(x),n=O(x),i=s0(x),s=q(x),o=n0(x),a=B({gameState:r,messageBox:o,camera:n}),c=Q({gameState:r,soundPlayer:t,dialog:s,ender:a});return i0(x,l=>{o.isOpen?l==="ACTION"&&o.next():s.isOpen?l==="ACTION"&&s.next():l!=="ACTION"&&c.update(l);}),r.actors._store.subscribe(l=>{n.update(r.player.playerProxy.position,r.mapStore.getDimensions()),i.render([...l,r.player.playerProxy],n.position);}),r.player.playerStore.subscribe(l=>{n.update(r.player.playerProxy.position,r.mapStore.getDimensions()),i.render([...r.actors._store.get(),l],n.position);}),x.title&&o.open(x.title),K(r,s,t,a,o)};

	exports.createGame = C0;
	exports.createSound = M;

	return exports;

})({});

const {createGame, createSound} = odyc
//startofthegame
const game = createGame({
    player: {
       sprite: `
          ...00...
          ...00...
          .000000.
          0.0000.0
          0.0000.0
          ..0000..
          ..0..0..
          ..0..0..
      `,
      position: [1, 1]
    },
    templates: {
      X: {
        sprite: 2,
      },
      D:{
          sprite: `
              ...99...
              ..9999..
              .999999.
              .999999.
              .999959.
              .999999.
              .999999.
              .999999.
          `,
          onEnter(target){
              target.remove()
          }
      },
      E: {
          sprite: `
              01010101
              10101010
              01010101
              10101010
              01010101
              10101010
              01010101
              10101010
          `,
          sound: createSound("POWERUP"),
          end: "Bravo"
      },
    K:{
      sprite: `
        ........
        .....555
        .....5.5
        555555.5
        5.5..5.5
        5....555
        ........
        ........
      `,
        dialog: "Vous avez trouvé une clé!",
        sound: createSound("PICKUP"),
        solid: false,
        onEnter(target){
          target.remove()
          game.getCell(5,4).solid = false
        }
      },
      P:{
        sprite:`
        .777....
        .707....
        6777....
        ..777...
        ..7777..
        ..777777
        ...7777.
        ....6...
      `,
        dialog: "Cuicui"
      }
    },
    map: `
      XXXXXXXX
      X....XEX
      X...PX.X
      X....X.X
      X....D.X
      X....X.X
      X.K..X.X
      XXXXXXXX
      `
})

//endofthegame
  </script>
</body>
</html>
